require.config({config:{moment:{noGlobal:!0}},paths:{moment:"../../js/moment.v2.8.1.min","moment-timezone":"../../js/moment-timezone.v0.2.1.min","moment-timezone-data":"../../js/moment-timezone-with-data-2010-2020",d3:"js/d3.v3.4.11.min","d3-tip":"js/d3-tip"}}),define(["d3","d3-tip"],function(t){console.log("ninjaCharts loaded. Using d3 version",t.version),console.log(t.tip()),t.ninja={};var e={ease:"linear",width:800,height:500,margin:{top:30,bottom:60,left:60,right:30},lineWidth:5,colours:{primary:"#8DC59A",secondary:"#204934",tertiary:"#CCE8DA",light:"#4B7C63",dark:"#0F2D1E"},cornerRounding:2,transitionDuration:1e3,lineInterpolation:"basis",lineFill:"none",lineOpacity:1,bubbleOpacity:.65,legendBackgroundOpacity:.65,legendTextOpacity:.75,underLineAreaOpacity:0,mouseOverOpacity:.95,legendFontSize:"14px",legendFontColor:"#a1a1a1",legendItemWidth:70,legendItemHeight:25,legendMargin:{top:0,bottom:0,left:60,right:0}};t.ninja.barChart=function(){function h(e){chartWidth=r-u.left-u.right,chartHeight=i-u.bottom-u.top,e.each(function(e){var h=chartWidth/e.length,g=0,f=0;t.max(e)>0&&(f=t.max(e)),t.min(e)<0&&(g=t.min(e));var d=t.scale.ordinal().domain(e.map(function(t,e){return e})).rangeRoundBands([0,chartWidth],0),p=t.scale.linear().domain([g,f]).range([chartHeight,0]),m=t.scale.linear().domain([Math.abs(f-g),0]).range([chartHeight,0]),y=t.svg.axis().scale(d).orient("bottom"),x=t.svg.axis().scale(p).orient("left");if(!n){n=t.select(this).append("svg").classed("chart",!0);var v=n.append("g").classed("container-group",!0);v.append("g").classed("chart-group",!0),v.append("g").classed("x-axis-group axis",!0),v.append("g").classed("y-axis-group axis",!0)}n.transition().attr({width:r,height:i}),n.select(".container-group").attr({transform:"translate("+u.left+","+u.top+")"}),n.select(".x-axis-group.axis").transition().ease(l).attr({transform:"translate(0,"+chartHeight+")"}).call(y),n.select(".y-axis-group.axis").transition().ease(l).call(x);var b=p(0),T=n.select(".chart-group").selectAll(".bar").data(e);T.enter().append("rect").classed("bar",!0).attr({x:function(t,e){return d(e)},width:.95*h,y:b,height:0,fill:o,rx:a,ry:a}).on("mouseover",c.customHover),T.transition().duration(s).ease(l).attr({x:function(t,e){return d(e)},width:.9*h,y:function(t){return p(t>0?t:0)},height:function(t){return Math.abs(m(t))}}),T.exit().transition().style({opacity:0}).remove()})}var n,r=e.width,i=e.height,a=e.cornerRounding,o=e.colours.secondary,s=e.transitionDuration,l=e.ease,u=e.margin,c=t.dispatch("customHover");return h.width=function(t){return arguments.length?(r=t,this):r},h.height=function(t){return arguments.length?(i=t,this):i},h.barColor=function(t){return arguments.length?(o=t,this):o},h.transitionDuration=function(t){return arguments.length?(s=t,this):s},h.ease=function(t){return arguments.length?(l=t,this):l},h.margin=function(t){return arguments.length?(u=t,this):u},t.rebind(h,c,"on"),h},t.ninja.lineChart=function(){function w(e){chartWidth=r-l.left-l.right,chartHeight=i-l.bottom-l.top,e.each(function(e){function k(e){return t.min(e,function(t){return new Date(t.x).getTime()})}function H(e){return t.max(e,function(t){return new Date(t.x).getTime()})}function M(e){return t.min(e,function(t){return t.y})}function W(e){return t.max(e,function(t){return t.y})}function L(){var t=new Array;t.push(1);var e=n.select(".chartTitle").selectAll("text.chartTitle").data(t);e.enter().append("text").attr("class","chartTitle").attr("x",chartWidth/2).attr("y",-(l.top/2)+10),e.exit().transition().duration(200).remove(),e.transition().duration(300).text(h).style("text-anchor","middle");var r=n.select(".yTitle").selectAll("text.yTitle").data(t);r.enter().append("text").attr("class","yTitle").attr("transform","rotate(-90)").style("text-anchor","middle"),r.exit().transition().duration(200).remove(),r.transition().duration(300).text(g).attr("x",-chartHeight/2).attr("y",-(.6*l.left));var i=n.select(".xTitle").selectAll("text.xTitle").data(t);i.enter().append("text").attr("class","xTitle").style("text-anchor","middle"),i.exit().transition().duration(200).remove(),i.transition().duration(300).text(d).attr("y",chartHeight+45).attr("x",chartWidth/2)}for(var f,T,w,A,a=e.length,O=0;a>O;O++){var C=k(e[O].timeseries),D=H(e[O].timeseries),j=M(e[O].timeseries),z=W(e[O].timeseries);0===O?(f=C,T=D,w=j,A=z):(f>C&&(f=C),D>T&&(T=D),z>A&&(A=z),w>j&&(w=j))}m&&(w=m),p&&(A=p);var Y=t.time.scale().range([0,chartWidth]);Y.domain([f,T]);var I=t.scale.linear().domain([w,A]).range([chartHeight,0]),B=t.svg.axis().scale(Y).orient("bottom"),F=t.svg.axis().scale(I).orient("left");if(!n){n=t.select(this).append("svg").classed("chart",!0);var S=n.append("g").classed("container-group",!0);S.append("g").classed("chart-group",!0),S.append("g").classed("x-axis-group axis",!0),S.append("g").classed("y-axis-group axis",!0),S.append("g").classed("chartTitle",!0),S.append("g").classed("yTitle",!0),S.append("g").classed("xTitle",!0)}n.transition().attr({width:r,height:i}),n.select(".container-group").attr({transform:"translate("+l.left+","+l.top+")"}),n.select(".x-axis-group.axis").transition().ease(s).attr({transform:"translate(0,"+I(0)+")"}).call(B),n.select(".y-axis-group.axis").transition().ease(s).call(F);var X=t.svg.line().x(function(t){return Y(t.x)}).y(function(t){return I(t.y)});X.interpolate(u);var E=t.svg.area().x(function(t){return Y(t.x)}).y0(I(0)).y1(function(t){return I(t.y)});E.interpolate(u),v=n.select(".chart-group").selectAll("path.area").data(e,function(t){return t.name}),v.enter().append("svg:path").attr("class","area").style("opacity",0).style("fill","none").style("stroke-width","0px"),v.exit().transition().duration(500).ease("linear").style("opacity",0).remove(),v.transition().delay(function(t,e){return 100*e}).duration(o).ease(s).attr("d",function(t){return E(t.timeseries)}).style("stroke",function(t){return t.colour}).style("fill",function(t){return t.colour}).style("opacity",x),b=n.select(".chart-group").selectAll("path.line").data(e,function(t){return t.name}),b.enter().append("svg:path").attr("class","line").style("opacity",0).style("fill",c).style("stroke-width","2.5px"),b.exit().transition().duration(500).ease("linear").style("opacity",0).remove(),b.transition().delay(function(t,e){return 100*e}).duration(o).ease(s).attr("d",function(t){return X(t.timeseries)}).style("stroke",function(t){return t.colour}).style("opacity",y),L()})}var n,p,m,v,b,r=e.width,i=e.height,a=e.colours.darkBlue,o=e.transitionDuration,s=e.ease,l=e.margin,u=e.lineInterpolation,c=e.lineFill,h="",g="",f="",d="",y=e.lineOpacity,x=e.underLineAreaOpacity,T=t.dispatch("customHover");return w.width=function(t){return arguments.length?(r=t,this):r},w.height=function(t){return arguments.length?(i=t,this):i},w.strokeColour=function(t){return arguments.length?(a=t,this):a},w.transitionDuration=function(t){return arguments.length?(o=t,this):o},w.ease=function(t){return arguments.length?(s=t,this):s},w.lineInterpolation=function(t){return arguments.length?(u=t,this):u},w.margin=function(t){return arguments.length?(l=t,this):l},w.title=function(t){return arguments.length?(h=t,this):h},w.yAxis1Title=function(t){return arguments.length?(g=t,this):g},w.yAxis2Title=function(t){return arguments.length?(f=t,this):f},w.xAxisTitle=function(t){return arguments.length?(d=t,this):d},w.yMax=function(t){return arguments.length?(p=t,this):p},w.yMin=function(t){return arguments.length?(m=t,this):m},w.areaOpacity=function(t){return arguments.length?(x=t,this):x},w.lineOpacity=function(t){return arguments.length?(y=t,this):y},t.rebind(w,T,"on"),w},t.ninja.stackedAreaWithSecondaryAxisLines=function(){function k(e){chartWidth=r-l.left-l.right,chartHeight=i-l.bottom-l.top,e.each(function(e){function q(){var t=new Array;t.push(1);var e=n.select(".chartTitle").selectAll("text.chartTitle").data(t);e.enter().append("text").attr("class","chartTitle").attr("x",chartWidth/2).attr("y",-(l.top/2)+10),e.exit().transition().duration(200).remove(),e.transition().duration(o).text(h).style("text-anchor","middle");var r=n.select(".yTitle").selectAll("text.yTitle").data(t);r.enter().append("text").attr("class","yTitle").attr("transform","rotate(-90)").style("text-anchor","middle"),r.exit().transition().duration(200).remove(),r.transition().duration(o).text(g).attr("x",-chartHeight/2).attr("y",-(.6*l.left));var i=n.select(".xTitle").selectAll("text.xTitle").data(t);i.enter().append("text").attr("class","xTitle").style("text-anchor","middle"),i.exit().transition().duration(200).remove(),i.transition().duration(o).text(d).attr("y",chartHeight+45).attr("x",chartWidth/2)}function G(){var e=t.scale.linear().domain([H,M]).range([chartHeight,0]),r=t.svg.axis().scale(e).orient("right"),i=t.svg.line().x(function(t){return Y(t.x)}).y(function(t){return e(t.y)});i.interpolate(u),console.log("line data",z),w=n.select(".line-group").selectAll("path.line").data(z,function(t){return t.name}),w.enter().append("svg:path").attr("class","line").style("opacity",0).style("fill",c).style("stroke-dasharray","3, 3").style("stroke-width","2.5px"),w.transition().delay(function(t,e){return 100*e}).duration(o).ease(s).attr("d",function(t){return i(t.values)}).style("stroke",function(t){return t.color}).style("opacity",y),console.log("test"),w.exit().transition().duration(o).ease("linear").style("opacity",0).remove(),n.select(".y-axis2-group.axis").transition().ease(s).attr({transform:"translate("+Y(C)+", 0)"}).call(r);var a=n.select(".y2Title").selectAll("text.y2Title").data([0]);a.enter().append("text").attr("class","y2Title").attr("transform","rotate(-90)").style("text-anchor","middle"),a.exit().transition().duration(200).remove(),a.transition().duration(o).text(f).attr("x",-chartHeight/2).attr("y",chartWidth+.9*l.right)}var A,k,H,M,W=(e.length,t.extent(e[0].values,function(t){return t.x})),O=W[0],C=W[1];console.log("min/max x",O,C);var D=t.layout.stack().values(function(t){return t.values}),j=D(e.filter(function(t){return t.type===T.area}));j.forEach(function(e){var n=t.extent(e.values,function(t){return t.y+t.y0});"undefined"==typeof A?A=n[0]:n[0]<A&&(A=n[1]),"undefined"==typeof k?k=n[1]:n[1]>k&&(k=n[1])}),console.log("min/max y",A,k);var z=e.filter(function(t){return t.type===T.line});z.forEach(function(e){var n=t.extent(e.values,function(t){return t.y});"undefined"==typeof H?H=n[0]:n[0]<H&&(H=n[1]),"undefined"==typeof M?M=n[1]:n[1]>M&&(M=n[1])}),console.log("min/max y2",H,M),"undefined"!=typeof m&&(A=m),"undefined"!=typeof p&&(k=p),console.log("min/max y",A,k);var Y=t.time.scale().range([0,chartWidth]);Y.domain([O,C]);var I=t.scale.linear().domain([A,k]).range([chartHeight,0]),B=t.svg.axis().scale(Y).orient("bottom"),F=t.svg.axis().scale(I).orient("left"),S=t.tip().attr("class","d3-tip");if(S.offset(function(t){var e=t.localMaxY-t.localMinY0;console.log("areaHeight",e),console.log("areaHeight scaled",I(e));var n=I(e);return console.log("vert offset",n),[n-20,-chartWidth/2+Y(t.x)]}).html(function(t){return"<strong>X:</strong> <span style='color:red'>"+t.x+"</span>"}),!n){n=t.select(this).append("svg").classed("chart",!0);var X=n.append("g").classed("container-group",!0).call(S);X.append("g").classed("area-group",!0),X.append("g").classed("line-group",!0),X.append("g").classed("x-axis-group axis",!0),X.append("g").classed("y-axis-group axis",!0),X.append("g").classed("y-axis2-group axis",!0),X.append("g").classed("chartTitle",!0),X.append("g").classed("yTitle",!0),X.append("g").classed("y2Title",!0),X.append("g").classed("xTitle",!0)}n.transition().attr({width:r,height:i}),n.select(".container-group").attr({transform:"translate("+l.left+","+l.top+")"}),n.select(".x-axis-group.axis").transition().ease(s).attr({transform:"translate(0,"+I(0)+")"}).call(B),n.select(".y-axis-group.axis").transition().ease(s).call(F);var E=t.svg.area().x(function(t){return Y(t.x)}).y0(function(t){return I(t.y0)}).y1(function(t){return I(t.y0+t.y)});E.interpolate(u);b=n.select(".area-group").selectAll("path.area").data(j,function(t){return t.name});var R=b.append("div").attr("class","tooltip").attr("id","tooltipDiv").style("opacity",0);b.enter().append("svg:path").attr("class","area").style("opacity",0).style("fill","none").on("mouseover",function(){t.select(this).style({opacity:v})}).on("mouseout",function(){t.select(this).style({opacity:x})}).on("mousemove",function(e){var n=t.mouse(this)[0],r=Y.invert(n);console.log("invertedx",r);var i=r,a=e.values,o=a.reduce(function(t,e){return Math.abs(e.x-i)<Math.abs(t.x-i)?e:t}),s=t.max(e.values,function(t){return t.y+t.y0}),l=t.min(e.values,function(t){return t.y+t.y0}),u=t.min(e.values,function(t){return t.y0});console.log("local max y",s),o.localMaxY=s,o.localMinY=l,o.localMinY0=u,console.log("local min y0",u),console.log("closest",o),R.transition().duration(200).style("opacity",.9),R.html(e.name).style("left",t.event.pageX+"px").style("top",t.event.pageY-2+"px")}).style("stroke-width","1px"),b.exit().transition().duration(0).ease(s).style("opacity",0).remove(),b.transition().duration(o).ease(s).attr("d",function(t){return E(t.values)}).style("stroke",function(){return"white"}).style("fill",function(t){return t.color}).style("opacity",x),console.log("stacked",j),q(),G()})}var n,p,m,b,w,r=e.width,i=e.height,a=e.colours.darkBlue,o=e.transitionDuration,s=e.ease,l=e.margin,u=e.lineInterpolation,c=e.lineFill,h="",g="",f="",d="",y=.8,x=.5,v=.65,T={area:"area",line:"line"},A=t.dispatch("customHover");return k.width=function(t){return arguments.length?(r=t,this):r},k.height=function(t){return arguments.length?(i=t,this):i},k.strokeColour=function(t){return arguments.length?(a=t,this):a},k.transitionDuration=function(t){return arguments.length?(o=t,this):o},k.ease=function(t){return arguments.length?(s=t,this):s},k.lineInterpolation=function(t){return arguments.length?(u=t,this):u},k.margin=function(t){return arguments.length?(l=t,this):l},k.title=function(t){return arguments.length?(h=t,this):h},k.yAxis1Title=function(t){return arguments.length?(g=t,this):g},k.yAxis2Title=function(t){return arguments.length?(f=t,this):f},k.xAxisTitle=function(t){return arguments.length?(d=t,this):d},k.yMax=function(t){return arguments.length?(p=t,this):p},k.yMin=function(t){return arguments.length?(m=t,this):m},k.areaOpacity=function(t){return arguments.length?(x=t,this):x},k.lineOpacity=function(t){return arguments.length?(y=t,this):y},t.rebind(k,A,"on"),k},t.ninja.bubbleChart=function(){function w(e){chartWidth=r-l.left-l.right,chartHeight=i-l.bottom-l.top,e.each(function(e){function E(){var t=new Array;t.push(1);var e=n.select(".chartTitle").selectAll("text.chartTitle").data(t);e.enter().append("text").attr("class","chartTitle").attr("x",chartWidth/2).attr("y",-(l.top/2)+10),e.exit().transition().duration(200).remove(),e.transition().duration(o).text(d).style("text-anchor","middle");var r=n.select(".yTitle").selectAll("text.yTitle").data(t);r.enter().append("text").attr("class","yTitle").attr("transform","rotate(-90)").style("text-anchor","middle"),r.exit().transition().duration(200).remove(),r.transition().duration(o).text(p).attr("x",-O((k-A)/2)).attr("y",-(.7*l.left));var i=n.select(".xTitle").selectAll("text.xTitle").data(t);i.enter().append("text").attr("class","xTitle").style("text-anchor","middle"),i.exit().transition().duration(200).remove(),i.transition().duration(o).text(y).attr("y",chartHeight+.9*l.bottom).attr("x",chartWidth/2)}var m,w,A,k,H,M;m=t.min(e,function(t){return t.x}),w=t.max(e,function(t){return t.x}),A=t.min(e,function(t){return t.y}),k=t.max(e,function(t){return t.y}),H=t.min(e,function(t){return t.r}),M=t.max(e,function(t){return t.r}),e.sort(function(t,e){return e.r-t.r});var W=t.scale.linear().domain([m,w]).range([0,chartWidth]),O=t.scale.linear().domain([A,k]).range([chartHeight,0]),C=t.scale.linear().domain([0,M]).range([0,u]);if(!b){var D=e.length;updateXYScalesBasedOnBubbleEdges=function(){for(var n=[],r=0;D>r;r++){var i=C(e[r].r),a=Math.abs(m-W.invert(i)),o=Math.abs(k-O.invert(i)),s=e[r].y+o,l=e[r].y-o,u=e[r].x+a,c=e[r].x-a;n.push({highX:u,highY:s,lowX:c,lowY:l})}var h=t.min(n,function(t){return t.lowX}),g=t.max(n,function(t){return t.highX}),f=t.min(n,function(t){return t.lowY}),d=t.max(n,function(t){return t.highY});k=d,A=f,w=g,m=h,v&&(A=v),x&&(k=x),W=t.scale.linear().domain([m,w]).range([0,chartWidth]),O=t.scale.linear().domain([A,k]).range([chartHeight,0])};for(var j=0;10>j;j++)updateXYScalesBasedOnBubbleEdges()}var z=t.svg.axis().scale(W).orient("bottom"),Y=t.svg.axis().scale(O).orient("left");if(!n){n=t.select(this).append("svg").classed("chart",!0);var I=n.append("g").classed("container-group",!0);I.append("g").classed("chart-group",!0),I.append("g").classed("x-axis-group axis",!0),I.append("g").classed("y-axis-group axis",!0),I.append("g").classed("chartTitle",!0),I.append("g").classed("yTitle",!0),I.append("g").classed("xTitle",!0)}n.transition().attr({width:r,height:i}),n.select(".container-group").attr({transform:"translate("+l.left+","+l.top+")"}),f&&(n.select(".x-axis-group.axis").transition().ease(s).attr({transform:"translate(0,"+O(0)+")"}).call(z),n.select(".y-axis-group.axis").transition().ease(s).attr({transform:"translate("+W(0)+",0)"}).call(Y));var B=C(0),F=n.select(".chart-group").selectAll(".bubble").data(e);if(F.enter().append("circle").classed("bubble",!0).attr({r:B}).on("mouseover",function(e){t.select(this).style({opacity:h,stroke:"black"}),T.mouseover(e)}).on("mouseout",function(){t.select(this).style({opacity:c,stroke:"white"}),T.mouseout([])}).on("click",function(){T.click([])}),F.transition().duration(o).ease(s).style({fill:function(t){return t.color},opacity:c,stroke:a}).attr({cx:function(t){return W(t.x)},cy:function(t){return O(t.y)},r:function(t){return C(t.r)}}),F.exit().transition().style({opacity:0}).remove(),g){var S=[1],X=n.select(".chart-group").selectAll(".border").data(S);X.enter().append("rect").attr("x",W(m)).attr("y",O(k)).attr("height",O(A)).attr("width",W(w)).style("stroke","black").style("fill","none").style("stroke-width",1)}E()})}var n,x,v,r=e.width,i=e.height,a="white",o=e.transitionDuration,s=e.ease,l=e.margin,u=50,c=e.bubbleOpacity,h=e.mouseOverOpacity,g=!1,f=!0,d="",p="",m="",y="",b=!1,T=t.dispatch("mouseover","mouseout","click");return w.showAxis=function(t){return arguments.length?(f=t,this):f},w.bubbleOpacity=function(t){return arguments.length?(c=t,this):c},w.width=function(t){return arguments.length?(r=t,this):r},w.height=function(t){return arguments.length?(i=t,this):i},w.strokeColour=function(t){return arguments.length?(a=t,this):a},w.transitionDuration=function(t){return arguments.length?(o=t,this):o},w.ease=function(t){return arguments.length?(s=t,this):s},w.bubbleSpill=function(t){return arguments.length?(b=t,this):b},w.margin=function(t){return arguments.length?(l=t,this):l},w.maxBubbleRadius=function(t){return arguments.length?(u=t,this):u},w.border=function(t){return arguments.length?(g=t,this):g},w.yMax=function(t){return arguments.length?(x=t,this):x},w.yMin=function(t){return arguments.length?(v=t,this):v},w.yAxis1Title=function(t){return arguments.length?(p=t,this):p},w.yAxis2Title=function(t){return arguments.length?(m=t,this):m},w.xAxisTitle=function(t){return arguments.length?(y=t,this):y},t.rebind(w,T,"on"),w},t.ninja.horizontalLegendSelectable=function(){function p(s){s.each(function(s){function b(t){return i*(t%m)}function T(t){return Math.floor((t+0)/m)*a}var u=s.length,p=r+e.margin.left+e.margin.right,m=Math.floor(r/i),y=Math.ceil(u/m),x=y*a+c.bottom+c.top;if(!n){n=t.select(this).append("svg").classed("chart",!0);var v=n.append("g").classed("container-group",!0);v.append("g").classed("legend",!0)}n.transition().attr({width:p,height:x}),n.select(".container-group").attr({transform:"translate("+c.left+","+c.top+")"});var w=n.select(".legend"),A=w.selectAll("text.legend").data(s);A.enter().append("text").attr("class","legend").style("font-weight","bold").style("fill",function(t){return t.textColor}).style("font-size",l).style("text-anchor","middle").style("opacity",g).attr("transform","translate(0, 6)"),A.exit().transition().duration(200).remove(),A.transition().duration(300).attr("x",function(t,e){return b(e)+i*f/2}).attr("y",function(t,e){return T(e)+a/2}).text(function(t){return t.name});var k=w.selectAll("rect.legend").data(s,function(t){return t.name+t.selected});k.enter().append("rect").attr("class","legend").style("opacity",function(t){return t.opacity}).on("click",d.click).on("mouseover",function(){t.select(this).style({opacity:h,stroke:"#525252"})}).on("mouseout",function(e){t.select(this).style({opacity:e.opacity,stroke:"white"})}),k.exit().transition().duration(200).attr("width",0).remove(),k.transition().duration(o).attr("x",function(t,e){return b(e)}).attr("y",function(t,e){return T(e)}).attr("height",a*f).attr("width",function(t){return t.selected?i*f:i*f*.95}).attr("ry",2).attr("rx",2).style("fill",function(t){return t.color})})}var n,r=e.width,i=e.legendItemWidth,a=e.legendItemHeight,o=e.transitionDuration,s=e.ease,l=e.legendFontSize,u=e.legendFontColor,c=e.legendMargin,h=.7,g=1,f=.95,d=t.dispatch("click");return p.width=function(t){return arguments.length?(r=t,this):r},p.itemWidth=function(t){return arguments.length?(i=t,this):i},p.itemHeight=function(t){return arguments.length?(a=t,this):a},p.fontSize=function(t){return arguments.length?(l=t,this):l},p.fontColor=function(t){return arguments.length?(u=t,this):u},p.transitionDuration=function(t){return arguments.length?(o=t,this):o},p.ease=function(t){return arguments.length?(s=t,this):s},p.margin=function(t){return arguments.length?(c=t,this):c},p.textOpacity=function(t){return arguments.length?(g=t,this):g},t.rebind(p,d,"on"),p},t.ninja.horizontalLegend=function(){function p(s){s.each(function(s){function T(t){return i*(t%y)}function w(t){return Math.floor((t+0)/y)*a}function M(t,e,n,r,i){return"M"+t+","+e+"h"+n+"v"+(r-1*i)+"a"+i+","+i+" 0 0 1 "+-i+","+i+"h"+(i-n)+"z"}var p=s.length,m=r+e.margin.left+e.margin.right,y=Math.floor(r/i),x=Math.ceil(p/y),v=x*a+c.bottom+c.top;if(!n){n=t.select(this).append("svg").classed("chart",!0);var b=n.append("g").classed("container-group",!0);b.append("g").classed("legend",!0)}n.transition().attr({width:m,height:v}),n.select(".container-group").attr({transform:"translate("+c.left+","+c.top+")"});var A=n.select(".legend"),k=A.selectAll("path.legend").data(s);k.enter().append("path").attr("class","legend").on("click",d.customClick).style("opacity",h).style("stroke-width","0px"),k.exit().transition().duration(200).attr("width",0).remove(),k.transition().duration(o).attr("d",function(t,e){return M(T(e),w(e),i*f,a*f,5)}).style("fill",function(t){return t.colour});var H=A.selectAll("text.legend").data(s);H.enter().append("text").attr("class","legend").style("font-weight","bold").style("fill",u).style("font-size",l).style("text-anchor","middle").style("opacity",g).attr("transform","translate(0, 6)"),H.exit().transition().duration(200).remove(),H.transition().duration(o).attr("x",function(t,e){return T(e)+i*f/2}).attr("y",function(t,e){return w(e)+a/2}).text(function(t){return t.name})})}var n,r=e.width,i=e.legendItemWidth,a=e.legendItemHeight,o=e.transitionDuration,s=e.ease,l=e.legendFontSize,u=e.legendFontColor,c=e.legendMargin,h=.5,g=e.legendTextOpacity,f=.95,d=t.dispatch("customClick");return p.backgroundOpacity=function(t){return arguments.length?(h=t,this):h},p.textOpacity=function(t){return arguments.length?(g=t,this):g},p.width=function(t){return arguments.length?(r=t,this):r},p.itemWidth=function(t){return arguments.length?(i=t,this):i},p.itemHeight=function(t){return arguments.length?(a=t,this):a},p.fontSize=function(t){return arguments.length?(l=t,this):l},p.fontColor=function(t){return arguments.length?(u=t,this):u},p.transitionDuration=function(t){return arguments.length?(o=t,this):o},p.ease=function(t){return arguments.length?(s=t,this):s},p.margin=function(t){return arguments.length?(c=t,this):c},t.rebind(p,d,"on"),p}});